<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
	<mapper namespace="com.sinnotech.hotel.mapper.MemberMapper"> 

 	<select id="getMemberList" resultType="com.sinnotech.hotel.dto.UsersDTO">
		SELECT
			  EMAIL
			, NAME
			, PHONE
			, PASSWORD
			, ROLE
		FROM
			USERS
	</select>
	<insert id="insertMember" parameterType="com.sinnotech.hotel.dto.UsersDTO">
		INSERT INTO USERS (EMAIL, PASSWORD, ROLE, NAME, PHONE, CREATED_AT, UPDATED_AT)
		VALUES (
			#{email}
			, #{password}
			, 1
			, #{name}
			, #{phone}
			, now() 
			, now()
		)
	</insert>
   <select id="overlappedEmail" parameterType="com.sinnotech.hotel.dto.UsersDTO" resultType="int">
		SELECT 
		      COUNT(email) 
		           FROM USERS 
				   WHERE email=#{email} 
				        AND users.delete_flag = false
	</select>
   <select id="overlappedPhone" parameterType="com.sinnotech.hotel.dto.UsersDTO" resultType="int">
		SELECT 
		      COUNT(phone) 
		           FROM USERS
		           WHERE phone=#{phone} 
		                AND users.delete_flag = false
	</select>
	<select id="getLoginMemberInfo" resultType="com.sinnotech.hotel.dto.UsersDTO">
		SELECT
			  *
		FROM users
		WHERE email = #{email}
              AND password = #{password}	
              AND users.temporary = true
              AND users.delete_flag = false
	</select>
	<select id="getLoginNonMemberInfo" resultType="com.sinnotech.hotel.dto.UsersDTO" >
		SELECT
			  *
		FROM users
		WHERE email = #{email}
              AND phone = #{phone}	
              AND users.temporary = false
              AND users.delete_flag = false
	</select>
	<insert id="insertNonMember" parameterType="com.sinnotech.hotel.dto.UsersDTO">
		INSERT INTO USERS (EMAIL, PASSWORD, ROLE, TEMPORARY, NAME, PHONE, CREATED_AT, UPDATED_AT)
		VALUES (
			#{email}
			, NULL
			, 1
			, false
			, #{name}
			, #{phone}
			, now() 
			, now()
		)
	</insert>
<update id="updateMember" parameterType="com.sinnotech.hotel.dto.UsersDTO">
		UPDATE USERS SET
			EMAIL = #{email}
			, NAME = #{name}
			, PHONE = #{phone}
			, UPDATEDAT = now()
		WHERE
			EMAIL = #{email}
	</update>
	
	<delete id="deleteMember" parameterType="int">
		DELETE FROM USERS
		WHERE EMAIL = #{email}
	</delete>
  </mapper>